<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNISPHERE</title>
<style>
body{
    margin:0;
    font-family:'Segoe UI', sans-serif;
    background:#f4f6f9;
    transition: background 0.5s;
}

#welcome{
    background:linear-gradient(135deg,#006400,#00a859);
    color:white;
    height:100vh;
    text-align:center;
    padding-top:100px;
}

.logo-big{ width:140px; border-radius:50%; }
.btn{ margin-top:40px; padding:14px 35px; background:yellow; color:#006400; border:none; border-radius:30px; font-weight:bold; cursor:pointer; }

.page{ display:none; min-height:100vh; padding-bottom:50px; transition: background 0.5s; }
.header{ padding:15px; background:#006400; color:white; text-align:center; }

.home-hero{
    background:linear-gradient(rgba(0,0,0,0.6),rgba(0,0,0,0.6)), url('https://i.ibb.co/XkkJJYjN/unnamed.jpg');
    background-size:cover; background-position:center; padding:80px 20px; color:white; text-align:center;
}
.home-hero h1{ font-size:36px; }
.home-hero p{ font-size:18px; opacity:0.9; }

.home-box{
    background:white; margin:-40px auto 20px auto; width:90%; max-width:900px; padding:30px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.15); text-align:center;
}

.option-btn{ padding:14px 30px; margin:10px; background:#006400; color:white; border:none; border-radius:25px; cursor:pointer; font-weight:bold; }

.card{ background:white; margin:20px auto; padding:20px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); max-width:350px; text-align:center; }

input, select{ padding:10px; width:85%; margin:8px 0; border-radius:5px; border:1px solid #ccc; }

label{ font-size:14px; color:#333; }

a{ color:#006400; text-decoration:none; cursor:pointer; }
</style>
</head>
<body>

<div id="welcome">
    <img src="https://i.ibb.co/jPJ8kjmL/download.png" class="logo-big">
    <h1>UNISPHERE</h1>
    <p>Empowering Aspirants & 100L Students</p>
    <button class="btn" onclick="enterSite()">Enter</button>
</div>

<div id="home" class="page">
    <div class="home-hero">
        <h1>UNISPHERE Academic Portal</h1>
        <p>Your Smart Digital Campus Experience</p>
    </div>

    <div class="home-box">
        <h2>Access Your Account</h2>
        <p>Secure login for Students & Aspirants</p>
        <button class="option-btn" onclick="openLogin()">Sign In</button>
        <button class="option-btn" onclick="openSignup()">Sign Up</button>
    </div>
</div>

<div id="loginPage" class="page">
<div class="header">Student Sign In</div>
<div class="card">
  <input type="text" id="loginInput" placeholder="Username or Email"><br>
  <input type="password" id="loginPass" placeholder="Password"><br>
  <label><input type="checkbox" id="rememberMe"> Remember Me</label><br>
  <button class="option-btn" onclick="login()">Login</button>
  <p style="margin-top:10px;"><a onclick="forgotPassword()">Forgot Password?</a></p>
  <h4 id="loginResult"></h4>
</div>
<button class="option-btn" onclick="goHome()">Back</button>
</div>

<div id="signupPage" class="page">
<div class="header">Create Account</div>
<div class="card">
  <input type="text" id="signupUsername" placeholder="Username"><br>
  <input type="email" id="signupEmail" placeholder="Email"><br>
  <input type="password" id="signupPass" placeholder="Password"><br>
  <select id="signupCategory">
    <option value="">Select Category</option>
    <option value="100L">100 Level Student</option>
    <option value="Aspirant">Aspirant</option>
  </select><br>
  <button class="option-btn" onclick="register()">Register</button>
  <h4 id="registerResult"></h4>
</div>
<button class="option-btn" onclick="goHome()">Back</button>
</div>

<div id="dashboard" class="page">
<div class="header">Student Dashboard</div>
<div class="card">
<p id="welcomeUser"></p>
<ul>
<li>üìö Course Registration</li>
<li>üìä Check Results</li>
<li>üí≥ Pay Acceptance Fee</li>
<li>üìù Update Profile</li>
<li>üîë <a onclick="changePassword()">Change Password</a></li>
</ul>
</div>
<button class="option-btn" onclick="goHome()">Logout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, setPersistence, browserLocalPersistence, browserSessionPersistence, sendPasswordResetEmail, updatePassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAe9H4tFxBhu7zhFyNtgpXuKjK4BSgwF5k",
  authDomain: "my-secur-app.firebaseapp.com",
  projectId: "my-secur-app",
  storageBucket: "my-secur-app.firebasestorage.app",
  messagingSenderId: "603859706635",
  appId: "1:603859706635:web:728362577418d208f8780e",
  measurementId: "G-GTMKG31C8E"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const usernameMap = {}; // username -> { email, category }

// NAVIGATION
function hideAll(){
    document.getElementById("home").style.display="none";
    document.getElementById("loginPage").style.display="none";
    document.getElementById("signupPage").style.display="none";
    document.getElementById("dashboard").style.display="none";
}
window.enterSite = ()=>{ document.getElementById("welcome").style.display="none"; document.getElementById("home").style.display="block"; }
window.openLogin = ()=>{ hideAll(); document.getElementById("loginPage").style.display="block"; }
window.openSignup = ()=>{ hideAll(); document.getElementById("signupPage").style.display="block"; }
window.goHome = ()=>{ hideAll(); document.getElementById("home").style.display="block"; document.body.style.background="#f4f6f9"; }

// SIGNUP
window.register = ()=>{
    const username = document.getElementById("signupUsername").value.trim();
    const email = document.getElementById("signupEmail").value.trim();
    const password = document.getElementById("signupPass").value;
    const category = document.getElementById("signupCategory").value;

    if(!username || !email || !password || !category){
        document.getElementById("registerResult").style.color="red";
        document.getElementById("registerResult").innerText="Fill all fields!";
        return;
    }
    if(password.length < 6){
        document.getElementById("registerResult").style.color="red";
        document.getElementById("registerResult").innerText="Password must be at least 6 characters!";
        return;
    }

    usernameMap[username.toLowerCase()] = { email, category };

    createUserWithEmailAndPassword(auth, email, password)
    .then(()=>{
        document.getElementById("registerResult").style.color="green";
        document.getElementById("registerResult").innerText="Registered! ‚úÖ";
        setTimeout(()=>{
            hideAll();
            document.getElementById("dashboard").style.display="block";
            document.getElementById("welcomeUser").innerText=`Welcome ${username} (${category})`;
            document.body.style.background="#000";
        },800);
    })
    .catch(error=>{
        document.getElementById("registerResult").style.color="red";
        document.getElementById("registerResult").innerText=error.message;
    });
}

// LOGIN
window.login = ()=>{
    const input = document.getElementById("loginInput").value.trim();
    const password = document.getElementById("loginPass").value;
    const remember = document.getElementById("rememberMe").checked;

    if(!input || !password){
        document.getElementById("loginResult").style.color="red";
        document.getElementById("loginResult").innerText="Fill all fields!";
        return;
    }

    // Use email if input is email, otherwise username
    let userInfo = usernameMap[input.toLowerCase()];
    if(!userInfo){
        // Try if input is an email registered
        userInfo = Object.values(usernameMap).find(u=>u.email.toLowerCase()===input.toLowerCase());
    }
    if(!userInfo){
        document.getElementById("loginResult").style.color="red";
        document.getElementById("loginResult").innerText="User not found!";
        return;
    }

    const persistence = remember ? browserLocalPersistence : browserSessionPersistence;

    setPersistence(auth, persistence)
    .then(() => signInWithEmailAndPassword(auth, userInfo.email, password))
    .then(()=>{
        document.getElementById("loginResult").style.color="green";
        document.getElementById("loginResult").innerText="Login Successful! ‚úÖ";
        setTimeout(()=>{
            hideAll();
            let username = Object.keys(usernameMap).find(k=>usernameMap[k].email === userInfo.email);
            document.getElementById("dashboard").style.display="block";
            document.getElementById("welcomeUser").innerText=`Welcome ${username} (${userInfo.category})`;
            document.body.style.background="#000";
        },800);
    })
    .catch(error=>{
        document.getElementById("loginResult").style.color="red";
        document.getElementById("loginResult").innerText=error.message;
    });
}

// FORGOT PASSWORD
window.forgotPassword = ()=>{
    const input = document.getElementById("loginInput").value.trim();
    if(!input){
        alert("Enter your username or email first!");
        return;
    }
    let userInfo = usernameMap[input.toLowerCase()];
    if(!userInfo){
        userInfo = Object.values(usernameMap).find(u=>u.email.toLowerCase()===input.toLowerCase());
    }
    if(!userInfo){
        alert("User not found!");
        return;
    }
    sendPasswordResetEmail(auth, userInfo.email)
    .then(()=>{
        alert(`Password reset link sent to ${userInfo.email}`);
    })
    .catch((error)=>{
        alert("Error: " + error.message);
    });
}

// CHANGE PASSWORD
window.changePassword = ()=>{
    const user = auth.currentUser;
    if(!user){
        alert("You need to be logged in to change password!");
        return;
    }
    const newPass = prompt("Enter your new password (min 6 chars):");
    if(!newPass || newPass.length < 6){
        alert("Password must be at least 6 characters!");
        return;
    }
    updatePassword(user, newPass)
    .then(()=>{
        alert("Password successfully changed!");
    })
    .catch((error)=>{
        alert("Error: " + error.message);
    });
}

// AUTO LOGIN
onAuthStateChanged(auth, (user) => {
  if(user){
    hideAll();
    document.getElementById("dashboard").style.display = "block";
    let email = user.email || "";
    let username = Object.keys(usernameMap).find(k=>usernameMap[k].email===email) || email.split("@")[0];
    let category = usernameMap[username.toLowerCase()]?.category || "";
    document.getElementById("welcomeUser").innerText = `Welcome ${username} (${category})`;
    document.body.style.background = "#000";
  }
});
</script>
</body>
</html>
